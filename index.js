const isDarkMode = () => {
	var theme = localStorage.getItem('isDarkMode');
	
	if(!theme)
		storageTheme(false);
	else
		return theme === 'true';
	return false;
}

function storageTheme(mode){
	localStorage.setItem("isDarkMode", String(mode));
}

function changeHeader(){
	const header = document.querySelector('#header-buttons');

	var darkModeButton = document.createElement('a');

	if(isDarkMode())
		setDarkMode();
	else
		rmDarkMode();
	
	darkModeButton.innerHTML = `<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10.4999 15.8147C12.0421 15.8147 13.5211 15.2021 14.6116 14.1117C15.7019 13.0212 16.3146 11.5423 16.3146 10.0001C16.3146 8.45793 15.7019 6.97896 14.6116 5.88848C13.521 4.79811 12.0421 4.18545 10.4999 4.18545C8.95778 4.18545 7.47881 4.79811 6.38833 5.88848C5.29796 6.97899 4.6853 8.45793 4.6853 10.0001C4.68471 11.5424 5.29721 13.0217 6.38773 14.1125C7.47839 15.203 8.95744 15.8153 10.4999 15.8147ZM10.4999 4.94755C11.84 4.94755 13.1252 5.47987 14.0727 6.42735C15.0201 7.37482 15.5525 8.66007 15.5525 10.0001C15.5525 11.34 15.0201 12.6253 14.0727 13.5728C13.1252 14.5202 11.8399 15.0526 10.4999 15.0526C9.15996 15.0526 7.8747 14.5202 6.92723 13.5728C5.97976 12.6253 5.44743 11.34 5.44743 10.0001C5.44743 8.66007 5.97976 7.37482 6.92723 6.42735C7.8747 5.47987 9.15996 4.94755 10.4999 4.94755ZM10.4451 16.6358C10.2346 16.6358 10.064 16.8064 10.064 17.0169V19.6189C10.064 19.8294 10.2346 20 10.4451 20C10.6555 20 10.8261 19.8294 10.8261 19.6189V17.0106C10.8261 16.9095 10.7861 16.8126 10.7145 16.7411C10.643 16.6696 10.5461 16.6295 10.4451 16.6295L10.4451 16.6358ZM15.6871 14.7411C15.5372 14.6357 15.3336 14.652 15.2023 14.7796C15.0711 14.9074 15.0492 15.1105 15.1502 15.2632L16.9944 17.1073C17.1455 17.2407 17.3743 17.2332 17.5164 17.0904C17.6586 16.9477 17.6652 16.7191 17.5313 16.5684L15.6871 14.7411ZM17.1292 10.0694C17.1292 10.2798 17.2998 10.4505 17.5103 10.4505H20.1186C20.329 10.4505 20.4997 10.2798 20.4997 10.0694C20.4997 9.85893 20.3291 9.68829 20.1186 9.68829H17.5103C17.3054 9.68815 17.1371 9.84998 17.1292 10.0547V10.0694ZM15.7629 5.3495L17.607 3.50534C17.7404 3.35424 17.7329 3.12543 17.5901 2.98328C17.4474 2.84114 17.2187 2.83453 17.0681 2.96845L15.2239 4.81261C15.0907 4.96372 15.0981 5.19249 15.2408 5.33467C15.3835 5.47685 15.6123 5.48328 15.7629 5.3495ZM10.5524 3.37053C10.7628 3.37053 10.9335 3.19989 10.9335 2.98945V0.381087C10.9335 0.170649 10.7628 0 10.5524 0C10.3419 0 10.1714 0.170641 10.1714 0.381087V2.98945C10.1714 3.09092 10.2118 3.18814 10.2838 3.25965C10.3556 3.33116 10.4531 3.37111 10.5546 3.37052L10.5524 3.37053ZM5.31033 5.26518C5.46085 5.38119 5.67408 5.36856 5.80976 5.23551C5.94545 5.10246 5.96234 4.88968 5.84941 4.7368L4.00525 2.89264C3.9355 2.81408 3.83623 2.76782 3.73123 2.76488C3.62608 2.7618 3.52461 2.80233 3.45045 2.87678C3.37629 2.95124 3.33605 3.053 3.33958 3.158C3.34296 3.26315 3.38951 3.36198 3.46837 3.43158L5.31033 5.26518ZM0.88932 10.3178L3.48945 10.3179C3.69988 10.3179 3.87053 10.1473 3.87053 9.93682C3.87053 9.72638 3.69989 9.55573 3.48945 9.55573H0.881087C0.670649 9.55573 0.5 9.72638 0.5 9.93682C0.5 10.1473 0.670641 10.3179 0.881087 10.3179L0.88932 10.3178ZM5.52085 14.5282C5.41968 14.5275 5.32261 14.5679 5.25153 14.64L3.40738 16.4842C3.33542 16.5554 3.29489 16.6523 3.29489 16.7536C3.29489 16.8548 3.33542 16.9519 3.40738 17.0231C3.55672 17.1708 3.79696 17.1708 3.94632 17.0231L5.79047 15.1768C5.89797 15.0677 5.92969 14.9047 5.87095 14.7632C5.81206 14.6217 5.67417 14.529 5.52085 14.5282Z" fill="white"/>
</svg>
`;

	darkModeButton.id="changeMode";
	darkModeButton.className = "top-menu__item top-menu__item--right";
	darkModeButton.onclick = () => {
		changeMode();
	}

	if(header != null)
		header.insertBefore(darkModeButton, header.firstChild);
}

function changeMode(){
	if(isDarkMode())
		rmDarkMode();
	else
		setDarkMode();
}

function setDarkMode(){
	storageTheme(true);
	var style = document.createElement('link');
	style.rel = 'stylesheet';
	style.type = 'text/css';
	style.href = chrome.extension.getURL('darkmode.css');
	style.setAttribute("id","dark-mode-css");
	(document.head||document.documentElement).appendChild(style);
}

function rmDarkMode(){
	storageTheme(false);
	const style = document.querySelector('#dark-mode-css');
	if(style)
		style.remove();
}

changeHeader();
